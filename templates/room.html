{% extends 'base.html' %} {% block title %}
<title>
  {% if roomname %} {{ roomname + " by " + host}} {% else %} Room {% endif %}
</title>
{% endblock %} {% block css %}
<link rel="stylesheet" href="{{url_for('static', filename='css/room.css')}}" />
{% endblock %} {% block content %}

<div class="output" id="messages"></div>
<div class="input">
  <span class="prompt">> </span>
  <input type="text" id="message" autocomplete="off" />
</div>

<script type="text/javascript">
  var socketio = io();

  // listen for messages and printout
  const messages = document.getElementById("messages");
  const createMessage = (name, msg) => {
    const content = `
    <div class="message">
      <span>
        <strong>${name}</strong>: ${msg}
      </span>
      <span class="date">
        ${new Date().toLocaleString()}
      </span>
    </div>
    `;
    messages.innerHTML += content;
  };

  socketio.on("message", (data) => {
    createMessage(data.nickname, data.message);
  });

  // send messages
  const sendMessage = () => {
    const message = document.getElementById("message");
    if (message.value == "") return;
    socketio.emit("message", { data: message.value });
    message.value = "";
  };

  document.addEventListener("DOMContentLoaded", function () {
    const inputField = document.getElementById("message");
    const outputDiv = document.querySelector(".output");

    function scrollToBottom() {
      outputDiv.scrollTop = outputDiv.scrollHeight;
    }

    inputField.addEventListener("keydown", function (event) {
      if (event.key === "Enter" && inputField.value != "") {
        sendMessage();
        inputField.value = "";

        // Scroll to bottom after adding new content
        scrollToBottom();
      }
    });

    // Close button functionality
    const closeButton = document.querySelector(".close-button");
    closeButton.addEventListener("click", function () {
      if (confirm("You're about to leave!")) {
        window.location.href = "/";
      }
    });
  });
</script>
{% endblock %}
